<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Assignment 10: Steering and crowds</title>
<link rel="stylesheet" href="style/cs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_assignment_10_steering_and_crowds">Assignment 10: Steering and crowds</a></li>
<li><a href="#_get_the_source">Get the source</a></li>
<li><a href="#_steerable_character">1. Steerable character</a></li>
<li><a href="#_crowds">2. Crowds</a></li>
<li><a href="#_unique">3. Unique</a></li>
<li><a href="#_hand_in_your_work">4. Hand-in your work</a>
<ul class="sectlevel2">
<li><a href="#_what_to_hand_in">4.1. What to hand-in</a></li>
<li><a href="#_how_to_hand_in">4.2. How to hand-in</a></li>
<li><a href="#_generating_images_movies_and_gifs">4.3. Generating images, movies and gifs</a></li>
<li><a href="#_update_your_readme_md">4.4. Update your Readme.md</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_assignment_10_steering_and_crowds">Assignment 10: Steering and crowds</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>In which, we implement a steering algorithm and crowd behaviors</em></p>
</div>
<div class="paragraph">
<p><strong>Due Friday, Dec 3, before midnight</strong></p>
</div>
<div class="paragraph">
<p>The goal of this lab is to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement a physics-based steering model for our character</p>
</li>
<li>
<p>Implement a variety of boid behaviors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&lt;!--&lt;br&gt;
&lt;center&gt;
&lt;video controls&gt;
		&lt;source src="steering.ogv"&gt;
&lt;/video&gt;
&lt;/center&gt;
&lt;br&gt;
-&#8594;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_get_the_source">Get the source</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On Github, do a <code>Fetch Upstream</code> to synchronize your forked repository with the class repository.</p>
</div>
<div class="paragraph">
<p>Then update the source on your local machine and rebuild.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; git pull
&gt; cd build
&gt; cmake ..; make</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_steerable_character">1. Steerable character</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;h2&gt;User interface overview&lt;/h2&gt;
&lt;hr&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;The camera can be controlled with the mouse:</p>
</div>
<div class="paragraph">
<p>&lt;ul&gt;
    &lt;li&gt;Left-button drag with the mouse to rotate
    &lt;li&gt;Right-button drag with the mouse to pan
    &lt;li&gt;Middle-button drag with the mouse to zoom
    &lt;li&gt;'f' button will focus the view on the character
&lt;/ul&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;Control-left click will set the position of the target (red dot)</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;Pressing the spacebar will reset the character at (0,0,0)</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;The code for this assignment includes the class ASteerable, which implements a
steerable character, and the class ABehavior, which implements various steering behaviors.
Subclasses of ABehavior compute desired velocities which are 'fed' to the steering
algorithm in ASteerable. You can control how a character moves by changing its behavior.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;We will build up our steering model in steps.</p>
</div>
<div class="paragraph">
<p>&lt;h3&gt;Step 1: Implement a simple seek behavior with basic steering model&lt;/h3&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;(5 points)&lt;/b&gt; Implement ASeek::computeDesiredVelocity(const ASteerable&amp; actor).
Also, set a default value for the constant ASeek::kMaxSpeed.
You may need to tweak this parameter to produce nice looking
results with your steering algorithm.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;(5 points)&lt;/b&gt; Compute _vd and _thetad in ASteerable::senseControlAct(const AVector3&amp; veld, double dt). Given a desired velocity and dt, senseControlAct() computes a global translation and rotation
and stores them in the member variable ATransform _characterRoot. To test your computation of _vd and _thetad, set the
_characterRoot using the following approach, e.g.
&lt;ol&gt;
&lt;li&gt;Compute \( \theta_d \). Store the result in member variable _thetad
&lt;li&gt;Compute \( v_d \). Store the result in member variable _vd
&lt;li&gt;Compute a new orientation \( R_y \) using \( \theta_d \)
&lt;li&gt;Compute a new velocity in global coordinates using v&lt;sub&gt;d&lt;/sub&gt;, e.g.
\( v^{t} = R_y \left( \begin{array}{c}
0 \\
0 \\
v_d
\end{array} \right)
\)
&lt;li&gt;Compute a new position using v&lt;sup&gt;t&lt;/sup&gt;,
e.g. \( p^{t+\Delta t} = p^t + v^t \Delta t \)
&lt;li&gt;Update _characterRoot with the new position and orientation
&lt;/ol&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;Note above that although in class, the vehicle has X forward (and rotates around Z),
note that in your basecode &lt;b&gt;Z is forward (and we rotate around Y)&lt;/b&gt;.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;Your application should look like this</p>
</div>
<div class="paragraph">
<p>&lt;br&gt;
&lt;br&gt;
&lt;img src="simpleSteer.gif"&gt;
&lt;br&gt;
&lt;br&gt;</p>
</div>
<div class="paragraph">
<p>&lt;h3&gt;Step 2: Implement translational dynamics (linear forces)&lt;/h3&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;(5 points)&lt;/b&gt; Extend ASteerable::senseControlAct(const AVector3&amp; veld, double dt)
to implement linear dynamics. Compute a force based on _vd and the current velocity (stored
in _state[VEL]). Use this force to compute derivatives and update the state for POS and VEL.
To test, update the translation of _characterRoot based on the computed located position
&lt;ol&gt;
&lt;li&gt;Compute a new orientation \( R_y \) using \( \theta_d \)
&lt;li&gt;Compute global change in position as
\( \Delta p = R_y \left( \begin{array}{c}
0 \\
0 \\
x^{t+\Delta t}
\end{array} \right)
\) where x is the local position stored in the character&#8217;s state vector.
&lt;li&gt;Compute a new position,
e.g. \( p^{t+\Delta t} = p^t + \Delta p \)
&lt;li&gt;Update _characterRoot with the new position and orientation
&lt;/ol&gt;</p>
</div>
<div class="paragraph">
<p>&lt;!--
&lt;p&gt;You may notice some weird behavior after imlementing this. Maybe something even like</p>
</div>
<div class="paragraph">
<p>&lt;br&gt;
&lt;br&gt;
&lt;img src="badForces1.gif"&gt;
&lt;br&gt;
&lt;br&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;(2 points)&lt;/b&gt; Remember in class: we talked about accuracy and stability for
numerical methods. We are currently using Euler&#8217;s Method to simulate our character&#8217;s
movement. Why and how is this happening (in your readme, answer in 1-2 sentences)?</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;To fix the problem, adjust the gain, ASteerable::kVelKv, which you use to compute _force.</p>
</div>
<div class="paragraph">
<p>Your character should now look something like
-&#8594;</p>
</div>
<div class="paragraph">
<p>&lt;br&gt;
&lt;br&gt;
&lt;img src="forcesOnly.gif"&gt;
&lt;br&gt;
&lt;br&gt;</p>
</div>
<div class="paragraph">
<p>&lt;h3&gt;Step 3: Implement rotational dynamics (torques)&lt;/h3&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;(5 points)&lt;/b&gt; Extend ASteerable::senseControlAct(const AVector3&amp; veld, double dt)
to implement rotational dynamics. Compute a torque based on _thetad and the current orientation (stored
in _state[ORI]). Use this force to compute derivatives and update the state for ORI and AVEL.
To complete your steerable character, update the translation and orientation of _characterRoot based on the current state
&lt;ol&gt;
&lt;li&gt;Compute a new orientation \( R_y \) using \( \theta^{t+\Delta t} \)
&lt;li&gt;Compute global change in position as
\( \Delta p = R_y \left( \begin{array}{c}
0 \\
0 \\
x^{t+\Delta t}
\end{array} \right)
\) where x is the local position stored in the character&#8217;s state vector.
&lt;li&gt;Compute a new position,
e.g. \( p^{t+\Delta t} = p^t + \Delta p \)
&lt;li&gt;Update _characterRoot with the new position and orientation
&lt;/ol&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;After this step, our goal is for the character to look like</p>
</div>
<div class="paragraph">
<p>&lt;br&gt;
&lt;br&gt;
&lt;img src="steering.gif"&gt;
&lt;br&gt;
&lt;br&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;However, to get nice movement, we need to tweak the gains:
ASteerable::kVelKp, ASteerable::kOriKp and ASteerable::kOriKv.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;One approach is to tweak these values manually. First, make large changes to find a
good magnitude for your parameter. Then make smaller changes to fine-tune. Also, change
parameters systematically, one at a time.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;However, our orientation controller is an example of &lt;i&gt;proportional derivative&lt;/i&gt;
control, which has well-understood properties. Specifically, recall that our dynamics
equation is</p>
</div>
<div class="paragraph">
<p>\[
\tau = I(k_{P} (\theta_d - \theta) - k_V \dot{\theta})
\]</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;We first solve for \( \tau \). Then we compute a new angular acceleration with
\( \ddot{\theta} = \tau/I \). The angular acceleration is then used to turn our
vehicle. The constants \( k_P, k_V \) for this type of controller can be defined
in terms of two parameters \( w_n \) and  \( \zeta \) like so</p>
</div>
<div class="paragraph">
<p>\[
k_P = (w_n)^2 \\
k_V = 2 \zeta w_n
\]</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;\( w_n \) is called the natural frequency and \( \zeta \) is called the damping ratio.
The rate of convergence follows the function \( e^{-\zeta w_n t}\), so this function will
be close to zero when \( \zeta w_n t = 4 \). We can use this to choose \( \zeta \) and
\( w_n \) so that we converge at an approximate time.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;Furthermore, the choice \( \zeta \) will determine if the system is
underdamped (e.g. oscillates), critically-damped (smoothly goes to \( \theta_d \) ),
or over-damped. Specifically,</p>
</div>
<div class="paragraph">
<p>&lt;ul&gt;
		&lt;li&gt;&lt;b&gt;Underdamped&lt;/b&gt; \( 0 \leq \zeta &lt; 1 \).  In the example below, we have
		 \( w_n = 8, \zeta = 0.25 \). This choice of values results in \(k_V = 4, k_P = 64 \)
				&lt;br&gt;
				&lt;br&gt;
				&lt;img src="oscillate.gif"&gt;
				&lt;br&gt;
				&lt;br&gt;
		&lt;li&gt;&lt;b&gt;Critically damped&lt;/b&gt; \( \zeta = 1 \).  In the example below, we \( w_n = 8, \zeta = 1 \).
				This choice of values results in \( k_V = 16, k_P = 64 \)
				&lt;br&gt;
				&lt;br&gt;
				&lt;img src="cdamped.gif"&gt;
				&lt;br&gt;
				&lt;br&gt;
		&lt;li&gt;&lt;b&gt;Overdamped&lt;/b&gt; \( \zeta &gt; 1 \).  In the example below, we \( w_n = 8, \zeta = 2 \)
				This choice of values results in \( k_V = 32, k_P = 64 \)
				&lt;br&gt;
				&lt;br&gt;
				&lt;img src="overdamped.gif"&gt;
				&lt;br&gt;
				&lt;br&gt;
&lt;/ul&gt;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_crowds">2. Crowds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;(5 points)&lt;/b&gt; For your orientation control, compute values for the gains kOriKp and kOriKv
such that the character&#8217;s turning is critically damped and converges in approximately 0.5 seconds.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;A final thought: You may find that if the character sits a while, it accumulates movement.
You can fix this by either adding a special case to not update when the character is
close to the goal, or by implementing a more sophisticated behavior which returns
a desired velocity of zero when within a threshold of the goal.</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;&lt;b&gt;Option 1 (1 points each)&lt;/b&gt; Implement additional individual behaviors such as
flee, avoid obstacles, arrive, depart, and wander. Or feel free to create your own!
&lt;p&gt;&lt;b&gt;Option 2 (2 points)&lt;/b&gt; Implement a crowd. Extend the basecode to create N
characters and implement alignment, cohesion, separation, leader</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unique">3. Unique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Personalize or extend the demos in this assignment. Here are some ideas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make your crowd look heterogeneous by</p>
<div class="ulist">
<ul>
<li>
<p>randomizing the colors</p>
</li>
<li>
<p>randomizing the sizes</p>
</li>
<li>
<p>randomizing the animation time so that motions are no longer synchronized</p>
</li>
</ul>
</div>
</li>
<li>
<p>Improve the animation of the characters.  Implement a walk controller which blends between walking and standing based on the character&#8217;s speed. When the speed is zero, the character should idle. When it is walking at the max speed, it should be walking.</p>
</li>
<li>
<p>Animate crowds with different types of characters, such as butterflies or stampeding elephants.</p>
</li>
<li>
<p>Implement crowds with different-sized characters, such as large ogres mixed with small goblins.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hand_in_your_work">4. Hand-in your work</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_to_hand_in">4.1. What to hand-in</h3>
<div class="ulist">
<ul>
<li>
<p>Your code</p>
</li>
<li>
<p>Images, movies, gifs, as appropriate</p>
</li>
<li>
<p>Your readme</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_hand_in">4.2. How to hand-in</h3>
<div class="paragraph">
<p>Check-in your code, images, and writeup and push the changes to Github.
If everything is uploaded correctly, you will see your work on Github.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; cd animation-toolkit
&gt; git add &lt;files&gt;
&gt; git commit -m "helpful message"
&gt; git push</code></pre>
</div>
</div>
<div class="paragraph">
<p>Best practice is to always commit changes as you work, rather than waiting until
the end to commit changes. You can always revert to an old version if you need to!</p>
</div>
<div class="paragraph">
<p>Your code should download and compile without modifications. Test your assignment on a lab machine (Park 230) to ensure that it works.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_images_movies_and_gifs">4.3. Generating images, movies and gifs</h3>
<div class="paragraph">
<p><strong>Screenshots</strong></p>
</div>
<div class="paragraph">
<p>On Ubuntu, you can take a screenshot by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prt Scrn to take a screenshot of the desktop.</p>
</li>
<li>
<p>Alt + Prt Scrn to take a screenshot of a window.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Gifs</strong></p>
</div>
<div class="paragraph">
<p>On Ubuntu, you can use Peek to create gifs.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="Labs/howtopeek.mp4" width="600" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p><strong>Movies</strong></p>
</div>
<div class="paragraph">
<p>On Ubuntu, you can use <code>recordmydesktop</code> to record movies in .ogv format.</p>
</div>
<div class="paragraph">
<p>By default, the whole desktop is recorded unless you give it a window id.
To get the window id, call <code>xwininfo</code> and click on the window. Then pass the
id to <code>recordmydesktop</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; recordmydesktop --windowid &lt;WindowId&gt; --no-sound  --v_quality 30 -o &lt;name&gt;.ogv</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the video, open it in firefox.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; firefox &lt;name&gt;.ogv</code></pre>
</div>
</div>
<div class="videoblock">
<div class="content">
<video src="Labs/howtorecord.mp4" width="600" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Files larger than 100 MB cannot be checked into git. In general,
videos should be less than 5 MB.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_update_your_readme_md">4.4. Update your Readme.md</h3>
<div class="paragraph">
<p>Update <code>assignments/a7-motion/Readme.md</code> to document the features in your assignment. Your readme should contain your images, gifs, and movies.</p>
</div>
<div class="paragraph">
<p>On github, you can drag and drop movies into your readme files. Images and gifs can also be added that way, or by including text such as the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>![Alternate text here](/path/to/image.png)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <a href="https://www.markdownguide.org/basic-syntax/">Guide</a> can help you with writing markdown.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-10-30 15:23:34 -0400
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>