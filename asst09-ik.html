<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<title>Assignment 9: Reach for your goals</title>
<link rel="stylesheet" href="style/cs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_assignment_9_reach_for_your_goals">Assignment 9: Reach for your goals</a></li>
<li><a href="#_get_the_source">Get the source</a></li>
<li><a href="#_two_link_analytic_method">1. Two-link analytic method</a></li>
<li><a href="#_eye_on_the_prize">2. Eye on the prize</a></li>
<li><a href="#_character_ik">3. Character IK</a>
<ul class="sectlevel2">
<li><a href="#_ccd">3.1. CCD</a></li>
<li><a href="#_analytical_method">3.2. Analytical method</a></li>
</ul>
</li>
<li><a href="#_dancer">4. Dancer</a></li>
<li><a href="#_unique">5. Unique</a></li>
<li><a href="#_hand_in_your_work">6. Hand-in your work</a>
<ul class="sectlevel2">
<li><a href="#_what_to_hand_in">6.1. What to hand-in</a></li>
<li><a href="#_how_to_hand_in">6.2. How to hand-in</a></li>
<li><a href="#_generating_images_movies_and_gifs">6.3. Generating images, movies and gifs</a></li>
<li><a href="#_update_your_readme_md">6.4. Update your Readme.md</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_assignment_9_reach_for_your_goals">Assignment 9: Reach for your goals</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>In which, we use inverse kinematics to animate our characters</em></p>
</div>
<div class="paragraph">
<p><strong>Due Friday, Nov 19, before midnight</strong></p>
</div>
<div class="paragraph">
<p>The goal of this lab is to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the two-link analytic IK algorithm from class</p>
</li>
<li>
<p>Implement two-link analytical and CCD algorithms on our character</p>
</li>
<li>
<p>Implement procedural animations based on IK</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_get_the_source">Get the source</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On Github, do a <code>Fetch Upstream</code> to synchronize your forked repository with the class repository.</p>
</div>
<div class="paragraph">
<p>Then update the source on your local machine and rebuild.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; git pull
&gt; cd build
&gt; cmake ..; make</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_two_link_analytic_method">1. Two-link analytic method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the file, <code>twolink.cpp</code>, implement a two-link kinematic chain using the algorithm from class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// ASkeleton will contain a two-link chain
// Assume joint 0 is the root
// Assume joint 1 is the middle joint
// Assume joint 2 is the end effector
// If your implementation is correct, the end effector should be positioned at goalPos
bool solveIKTwoLink(Skeleton&amp; skeleton, const vec3&amp; goalPos)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the demo from the <code>build</code> directory, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>build&gt; ../bin/a9-iksimple</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you change the local rotation of a joint, you must call fk() to update the global rotations and translations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When implementing updateIK(), it is best to approach the task systematically. I strongly recommend the following approach</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, set the goal position to something along the x axis. For example, set the goal position to (100,0,0) in the UI.</p>
<div class="ulist">
<ul>
<li>
<p>Solve for \(\theta_{2z}\) and set the rotation for the elbow. If done correctly, the distance
between the wrist and root will match the distance between the goal position and the root. Print out the distance between the wrist and shoulder. It should be 100.</p>
</li>
<li>
<p>Next, solve for \(\theta_{1z}\) and set the rotation for the root. If done correctly, the wrist should be at the desired position exactly.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Last, solve for full root rotation in terms of \(\gamma\) and \(\beta\). Once correct, the wrist position should match the goal position&#8201;&#8212;&#8201;so long as it is in reach.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="Labs/2link.ogv" alt="2link">
</div>
</div>
<div class="paragraph">
<p>The basecode includes a simple interface and 3D viewer. See above for a demo.</p>
</div>
<div class="paragraph">
<p>The camera can be controlled with the mouse:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Left-button drag with the mouse to rotate</p>
</li>
<li>
<p>Right-button drag with the mouse to pan</p>
</li>
<li>
<p>Middle-button drag with the mouse to zoom</p>
</li>
<li>
<p>'f' button will focus the view on the character</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The player control panel on the top left can be used to play/pause, step through keys, and see the simulation time.</p>
</div>
<div class="paragraph">
<p>The panel at the bottom left can be used to set the goal position of the end effector.
The target position can also be moved with the mouse by holding down the Ctrl key.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eye_on_the_prize">2. Eye on the prize</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the file, <code>looker.cpp</code>, implement a character whose gaze follows a target.</p>
</div>
<div class="paragraph">
<p>Your algorithm should use the CCD&#8217;s angle/axis computation (with nudge factor of
1) to align the forward direction of the head with the target. The forward
direction of the head is the Z axis (0,0,1) in its local coordinates.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Labs/looker.gif" alt="looker">
</div>
</div>
<div class="paragraph">
<p>To run the demo from the <code>build</code> directory, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>build&gt; ../bin/a9-looker</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_character_ik">3. Character IK</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the file, <code>skeleton_ik.cpp</code>, implement a poseable character using the CCD algorithm.
This file implements a class which overrides <code>Skeleton</code> to support joints whose positions can be
set using global coordinates. Inverse kinematics is used to calculate the corresponding local
rotations of the interior joints.</p>
</div>
<div class="sect2">
<h3 id="_ccd">3.1. CCD</h3>
<div class="paragraph">
<p>Implement the CCD algorithm <code>SkeletonIK::solveIKCCD()</code>.</p>
</div>
<div class="paragraph">
<p>&lt;pre&gt;
bool AIKController::solveIKCCD(ASkeleton&amp; skeleton, int jointid,
    const AVector3&amp; goalPos, int chainSize, int maxIters)
{
    // recompute the chain if the end effector or chain size changes
    if (_selectedJoint != jointid || chainSize != (int) _chain.size())
    {
        computeJointChain(skeleton, jointid, chainSize);
    }</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// There are no joints in the IK chain for manipulation
if (_chain.size() == 0) return true;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// implement CCD algorithm here</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    return false;
}
&lt;/pre&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>To run the demo from the &lt;b&gt;build&lt;/b&gt; directory, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>build&gt; ../bin/a9-ik</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you change the local rotation of a joint, you must call fk() to update the global rotations and translations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Implementation Hints</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When implementing CCD, make the chain length 1 to start and ensure that a single joint can follow the target.</p>
</li>
<li>
<p>Test in your function that your angle/axis computation is correct by computing whether the computed rotation indeed rotates the limb towards the target.</p>
</li>
<li>
<p>Then, make sure that you can set the rotation matrix correctly in the joint&#8217;s local coordinate system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basecode comes with a viewer to help you test your algorithm.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="Labs/ikccd.ogv" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>User interface overview</p>
</div>
<div class="paragraph">
<p>The camera can be controlled with the mouse:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Left-button drag with the mouse to rotate</p>
</li>
<li>
<p>Right-button drag with the mouse to pan</p>
</li>
<li>
<p>Middle-button drag with the mouse to zoom</p>
</li>
<li>
<p>'f' button will focus the view on the character</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The left frame lets you select joints, reset the pose, and set the goal position maunally.</p>
</div>
<div class="paragraph">
<p>The target position can also be moved with the mouse by holding down the Ctrl key.</p>
</div>
<div class="paragraph">
<p>The right panel lets you select the algorithm for IK along with IK paramaters. For CCD:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Epsilon: how close to the goal do we need to be to stop iterating</p>
</li>
<li>
<p>Max iterations: max number of iterations to use before stopping the agorithm</p>
</li>
<li>
<p>Chain length: the number of ancestors to "nudge" towards the goal. If the chain size is -1, we use all ancestors up to (but excluding) the root.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_analytical_method">3.2. Analytical method</h3>
<div class="paragraph">
<p>&lt;p&gt;In this question, implement &lt;b&gt;IKController::solveIKAnalytic()&lt;/b&gt; located in
&lt;b&gt;libsrc/animation/AIKcontroller-basecode.cpp&lt;/b&gt;. In this question, you will combine the
techniques of the simple two-link analytic approach with CCD&#8217;s angle/axis calculation. This work
will allow us to animate the legs and arms of the character such that the knees and elbows
bend along their natural axis.</p>
</div>
<div class="paragraph">
<p>&lt;pre&gt;
bool AIKController::solveIKAnalytic(ASkeleton&amp; skeleton, int jointid, const AVector3&amp; goalPos)
&lt;/pre&gt;</p>
</div>
<div class="paragraph">
<p>&lt;p&gt;To run the demo from the &lt;b&gt;build&lt;/b&gt; directory, type
&lt;pre class="prettyprint lang-sh"&gt;
build&gt; ../bin/a9-ik
&lt;/pre&gt;
Set the IK type to &lt;b&gt;Analytic&lt;/b&gt; to test your work.
&lt;/p&gt;
&lt;br&gt;</p>
</div>
<div class="paragraph">
<p>Implementation hints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the angle/axis CCD computation to solve for the grandparent joint rotation.</p>
</li>
<li>
<p>Use the law of cosines to solve for the parent joint rotation.</p>
</li>
<li>
<p>Use the follow axis formula to choose the axis of rotation for the parent joint:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vec3 limbDir = parentJoint-&gt;getLocalTranslation();
limbDir.Normalize();
vec3 axis = limbDir.Cross(vec3(0,0,-1));
if (limbDir[1] &lt; 0) axis = limbDir.Cross(vec3(0,0,1));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dancer">4. Dancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the file <code>dancer.cpp</code>, implement a procedural algorithm to make our character dance.
Your solution should animate the hands and feet to move up and down (for example, using sine or cosine)
and then IK is used to update the rotations of the intermediate joints. Use either solveIKAnalytic or solveIKCCD
to create the motion.</p>
</div>
<div class="paragraph">
<p>Your solution will modify the motion in idle.bvh to make the hands and hips move differently.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Labs/dancer.gif" alt="dancer">
</div>
</div>
<div class="paragraph">
<p>To run the demo from the &lt;b&gt;build&lt;/b&gt; directory, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>build&gt; ../bin/a9-dancer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Demo requirements</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You should animate the hips back and forth and up and down.</p>
</li>
<li>
<p>You should animate the hands up and down as shown.</p>
</li>
<li>
<p>The feet should not move</p>
</li>
<li>
<p>Note: You may use either sine/cosine or a spline to animate the hips and hands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Suggested approach</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Animate the hand targets first.  &lt;br&gt;&lt;img src="dancer1.gif"&gt;</p>
</li>
<li>
<p>Then use AIKController to position the hands so that they follow the targets &lt;br&gt;&lt;img src="dancer2.gif"&gt;</p>
</li>
<li>
<p>Then animate the position of the hips &lt;br&gt;&lt;img src="dancer3.gif"&gt;</p>
</li>
<li>
<p>Then pin the feet to their original position using AIKController &lt;br&gt;&lt;img src="dancer4.gif"&gt;</p>
</li>
<li>
<p>Then reset the rotation of the feet to their original global rotation &lt;br&gt;&lt;img src="dancer5.gif"&gt;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unique">5. Unique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Personalize one the demos from this assignment. Below are some ideas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make you own unique animation based on inverse kinematics, splines, and motions.  For example, make a new dance, have the character hold a
cup, or wave.</p>
</li>
<li>
<p>Try your procedural dance or look on an other motions.</p>
</li>
<li>
<p>Try creating a procedural walker by using IK on the legs.</p>
</li>
<li>
<p>Create a procedural motion for an animal or insect, such as a spider, centipede, cat, ostrich, or fish.</p>
</li>
<li>
<p>Create a unique looking character or environment.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hand_in_your_work">6. Hand-in your work</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_to_hand_in">6.1. What to hand-in</h3>
<div class="ulist">
<ul>
<li>
<p>Your code</p>
</li>
<li>
<p>Images, movies, gifs, as appropriate</p>
</li>
<li>
<p>Your readme</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_hand_in">6.2. How to hand-in</h3>
<div class="paragraph">
<p>Check-in your code, images, and writeup and push the changes to Github.
If everything is uploaded correctly, you will see your work on Github.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; cd animation-toolkit
&gt; git add &lt;files&gt;
&gt; git commit -m "helpful message"
&gt; git push</code></pre>
</div>
</div>
<div class="paragraph">
<p>Best practice is to always commit changes as you work, rather than waiting until
the end to commit changes. You can always revert to an old version if you need to!</p>
</div>
<div class="paragraph">
<p>Your code should download and compile without modifications. Test your assignment on a lab machine (Park 230) to ensure that it works.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_images_movies_and_gifs">6.3. Generating images, movies and gifs</h3>
<div class="paragraph">
<p><strong>Screenshots</strong></p>
</div>
<div class="paragraph">
<p>On Ubuntu, you can take a screenshot by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prt Scrn to take a screenshot of the desktop.</p>
</li>
<li>
<p>Alt + Prt Scrn to take a screenshot of a window.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Gifs</strong></p>
</div>
<div class="paragraph">
<p>On Ubuntu, you can use Peek to create gifs.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="Labs/howtopeek.mp4" width="600" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p><strong>Movies</strong></p>
</div>
<div class="paragraph">
<p>On Ubuntu, you can use <code>recordmydesktop</code> to record movies in .ogv format.</p>
</div>
<div class="paragraph">
<p>By default, the whole desktop is recorded unless you give it a window id.
To get the window id, call <code>xwininfo</code> and click on the window. Then pass the
id to <code>recordmydesktop</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; recordmydesktop --windowid &lt;WindowId&gt; --no-sound  --v_quality 30 -o &lt;name&gt;.ogv</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the video, open it in firefox.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; firefox &lt;name&gt;.ogv</code></pre>
</div>
</div>
<div class="videoblock">
<div class="content">
<video src="Labs/howtorecord.mp4" width="600" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Files larger than 100 MB cannot be checked into git. In general,
videos should be less than 5 MB.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_update_your_readme_md">6.4. Update your Readme.md</h3>
<div class="paragraph">
<p>Update <code>assignments/a9-ik/Readme.md</code> to document the features in your assignment. Your readme should contain your images, gifs, and movies.</p>
</div>
<div class="paragraph">
<p>On github, you can drag and drop movies into your readme files. Images and gifs can also be added that way, or by including text such as the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>![Alternate text here](/path/to/image.png)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <a href="https://www.markdownguide.org/basic-syntax/">Guide</a> can help you with writing markdown.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-11-06 11:25:42 -0400
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>